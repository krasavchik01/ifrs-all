{% extends "base.html" %}

{% block title %}Аналитика рынка - АРФР{% endblock %}
{% block page_title %}Аналитика страхового рынка Казахстана{% endblock %}

{% block content %}
<style>
    .market-card {
        transition: all 0.3s ease;
        cursor: pointer;
    }
    .market-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .growth-badge {
        padding: 3px 8px;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    .growth-positive { background: #d4edda; color: #155724; }
    .growth-negative { background: #f8d7da; color: #721c24; }
    .growth-neutral { background: #e9ecef; color: #495057; }
    .segment-indicator {
        width: 10px;
        height: 10px;
        border-radius: 2px;
        display: inline-block;
        margin-right: 8px;
    }
    .concentration-warning {
        border-left: 4px solid #f39c12;
    }
</style>

<!-- Основные показатели рынка -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="stat-card market-card" onclick="showDetailedMetric('premiums')">
            <div class="stat-icon primary"><i class="bi bi-cash-stack"></i></div>
            <div class="stat-label">Валовые премии</div>
            <div class="stat-value">1.85 трлн ₸</div>
            <div class="stat-change positive"><i class="bi bi-arrow-up"></i> +15.2% YoY</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card market-card" onclick="showDetailedMetric('claims')">
            <div class="stat-icon warning"><i class="bi bi-receipt"></i></div>
            <div class="stat-label">Выплаты</div>
            <div class="stat-value">892 млрд ₸</div>
            <div class="stat-change negative"><i class="bi bi-arrow-up"></i> +18.5% YoY</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card market-card" onclick="showDetailedMetric('assets')">
            <div class="stat-icon success"><i class="bi bi-bank"></i></div>
            <div class="stat-label">Активы рынка</div>
            <div class="stat-value">2.85 трлн ₸</div>
            <div class="stat-change positive"><i class="bi bi-arrow-up"></i> +12.3% YoY</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card market-card" onclick="showDetailedMetric('penetration')">
            <div class="stat-icon danger"><i class="bi bi-percent"></i></div>
            <div class="stat-label">Проникновение</div>
            <div class="stat-value">1.8%</div>
            <div class="stat-change">от ВВП</div>
        </div>
    </div>
</div>

<!-- Дополнительные метрики -->
<div class="row g-4 mb-4">
    <div class="col-md-2">
        <div class="card text-center p-3">
            <div class="h4 mb-0 text-primary">27</div>
            <small class="text-muted">Компаний</small>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center p-3">
            <div class="h4 mb-0 text-success">48.2%</div>
            <small class="text-muted">Loss Ratio</small>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center p-3">
            <div class="h4 mb-0 text-warning">92.5%</div>
            <small class="text-muted">Combined Ratio</small>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center p-3">
            <div class="h4 mb-0 text-info">68.5%</div>
            <small class="text-muted">Retention</small>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center p-3">
            <div class="h4 mb-0">2.15</div>
            <small class="text-muted">Ср. Nmп</small>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center p-3">
            <div class="h4 mb-0 text-danger">58.2%</div>
            <small class="text-muted">HHI топ-5</small>
        </div>
    </div>
</div>

<!-- Предупреждение о концентрации -->
<div class="alert alert-warning concentration-warning d-flex align-items-center mb-4" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-3" style="font-size: 1.5rem;"></i>
    <div>
        <strong>Высокая концентрация рынка!</strong> Топ-5 компаний контролируют 58.2% рынка. Рекомендуется мониторинг антимонопольных рисков.
        <button class="btn btn-sm btn-outline-warning ms-3" onclick="showConcentrationAnalysis()">Анализ концентрации</button>
    </div>
</div>

<!-- Графики основные -->
<div class="row g-4 mb-4">
    <div class="col-md-8">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5><i class="bi bi-graph-up me-2"></i>Динамика рынка</h5>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary active" onclick="setChartPeriod('5y')">5 лет</button>
                    <button class="btn btn-outline-primary" onclick="setChartPeriod('3y')">3 года</button>
                    <button class="btn btn-outline-primary" onclick="setChartPeriod('1y')">1 год</button>
                </div>
            </div>
            <div class="card-body">
                <canvas id="marketDynamicsChart" height="300"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-header">
                <h5><i class="bi bi-pie-chart me-2"></i>Структура рынка</h5>
            </div>
            <div class="card-body">
                <canvas id="marketStructureChart" height="300"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Сегменты рынка -->
<div class="row g-4 mb-4">
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header">
                <h5><i class="bi bi-bar-chart me-2"></i>Премии по сегментам</h5>
            </div>
            <div class="card-body">
                <canvas id="segmentPremiumsChart" height="280"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header">
                <h5><i class="bi bi-arrow-left-right me-2"></i>Рост по сегментам YoY</h5>
            </div>
            <div class="card-body">
                <canvas id="segmentGrowthChart" height="280"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Детальная таблица сегментов -->
<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5><i class="bi bi-table me-2"></i>Анализ сегментов рынка</h5>
        <button class="btn btn-sm btn-outline-primary" onclick="exportSegmentData()">
            <i class="bi bi-download me-1"></i>Экспорт
        </button>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Сегмент</th>
                        <th>Премии</th>
                        <th>Доля</th>
                        <th>Рост YoY</th>
                        <th>Loss Ratio</th>
                        <th>Компаний</th>
                        <th>HHI</th>
                        <th>Тренд</th>
                    </tr>
                </thead>
                <tbody>
                    <tr onclick="showSegmentDetails('life')" style="cursor: pointer;">
                        <td><span class="segment-indicator" style="background: #3498db;"></span><strong>Life страхование</strong></td>
                        <td>485 млрд ₸</td>
                        <td>26.2%</td>
                        <td><span class="growth-badge growth-positive">+22.5%</span></td>
                        <td>42.5%</td>
                        <td>8</td>
                        <td>0.185</td>
                        <td><i class="bi bi-arrow-up text-success"></i></td>
                    </tr>
                    <tr onclick="showSegmentDetails('auto')" style="cursor: pointer;">
                        <td><span class="segment-indicator" style="background: #27ae60;"></span><strong>Автострахование</strong></td>
                        <td>412 млрд ₸</td>
                        <td>22.3%</td>
                        <td><span class="growth-badge growth-positive">+8.5%</span></td>
                        <td>58.2%</td>
                        <td>18</td>
                        <td>0.142</td>
                        <td><i class="bi bi-arrow-up text-success"></i></td>
                    </tr>
                    <tr onclick="showSegmentDetails('property')" style="cursor: pointer;">
                        <td><span class="segment-indicator" style="background: #f39c12;"></span><strong>Имущество</strong></td>
                        <td>325 млрд ₸</td>
                        <td>17.6%</td>
                        <td><span class="growth-badge growth-positive">+12.3%</span></td>
                        <td>45.8%</td>
                        <td>15</td>
                        <td>0.168</td>
                        <td><i class="bi bi-arrow-up text-success"></i></td>
                    </tr>
                    <tr onclick="showSegmentDetails('health')" style="cursor: pointer;">
                        <td><span class="segment-indicator" style="background: #e74c3c;"></span><strong>ДМС</strong></td>
                        <td>285 млрд ₸</td>
                        <td>15.4%</td>
                        <td><span class="growth-badge growth-positive">+18.2%</span></td>
                        <td>52.1%</td>
                        <td>12</td>
                        <td>0.195</td>
                        <td><i class="bi bi-arrow-up text-success"></i></td>
                    </tr>
                    <tr onclick="showSegmentDetails('liability')" style="cursor: pointer;">
                        <td><span class="segment-indicator" style="background: #9b59b6;"></span><strong>Ответственность</strong></td>
                        <td>198 млрд ₸</td>
                        <td>10.7%</td>
                        <td><span class="growth-badge growth-positive">+15.8%</span></td>
                        <td>38.5%</td>
                        <td>14</td>
                        <td>0.152</td>
                        <td><i class="bi bi-arrow-up text-success"></i></td>
                    </tr>
                    <tr onclick="showSegmentDetails('cargo')" style="cursor: pointer;">
                        <td><span class="segment-indicator" style="background: #1abc9c;"></span><strong>Грузы</strong></td>
                        <td>85 млрд ₸</td>
                        <td>4.6%</td>
                        <td><span class="growth-badge growth-negative">-5.2%</span></td>
                        <td>62.3%</td>
                        <td>10</td>
                        <td>0.225</td>
                        <td><i class="bi bi-arrow-down text-danger"></i></td>
                    </tr>
                    <tr onclick="showSegmentDetails('other')" style="cursor: pointer;">
                        <td><span class="segment-indicator" style="background: #95a5a6;"></span><strong>Прочие</strong></td>
                        <td>60 млрд ₸</td>
                        <td>3.2%</td>
                        <td><span class="growth-badge growth-neutral">+2.1%</span></td>
                        <td>55.8%</td>
                        <td>8</td>
                        <td>0.285</td>
                        <td><i class="bi bi-dash text-muted"></i></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Топ компании -->
<div class="row g-4 mb-4">
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header">
                <h5><i class="bi bi-trophy me-2"></i>Топ-10 по премиям</h5>
            </div>
            <div class="card-body">
                <canvas id="topCompaniesChart" height="300"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header">
                <h5><i class="bi bi-graph-up-arrow me-2"></i>Лидеры роста</h5>
            </div>
            <div class="card-body p-0">
                <table class="table mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Компания</th>
                            <th>Премии</th>
                            <th>Рост</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Nomad Life</strong></td>
                            <td>89.3 млрд</td>
                            <td><span class="growth-badge growth-positive">+35.2%</span></td>
                        </tr>
                        <tr>
                            <td><strong>Аманат</strong></td>
                            <td>45.8 млрд</td>
                            <td><span class="growth-badge growth-positive">+28.5%</span></td>
                        </tr>
                        <tr>
                            <td><strong>Халык-Life</strong></td>
                            <td>125.4 млрд</td>
                            <td><span class="growth-badge growth-positive">+22.1%</span></td>
                        </tr>
                        <tr>
                            <td><strong>Интертич</strong></td>
                            <td>48.5 млрд</td>
                            <td><span class="growth-badge growth-positive">+18.5%</span></td>
                        </tr>
                        <tr>
                            <td><strong>Freedom Life</strong></td>
                            <td>78.2 млрд</td>
                            <td><span class="growth-badge growth-positive">+15.8%</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Региональный анализ -->
<div class="card mb-4">
    <div class="card-header">
        <h5><i class="bi bi-geo-alt me-2"></i>Региональное распределение</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <canvas id="regionalChart" height="250"></canvas>
            </div>
            <div class="col-md-6">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Регион</th>
                            <th>Премии</th>
                            <th>Доля</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Алматы</td>
                            <td>685 млрд</td>
                            <td>37.0%</td>
                        </tr>
                        <tr>
                            <td>Астана</td>
                            <td>425 млрд</td>
                            <td>23.0%</td>
                        </tr>
                        <tr>
                            <td>Западный КЗ</td>
                            <td>285 млрд</td>
                            <td>15.4%</td>
                        </tr>
                        <tr>
                            <td>Южный КЗ</td>
                            <td>195 млрд</td>
                            <td>10.5%</td>
                        </tr>
                        <tr>
                            <td>Прочие</td>
                            <td>260 млрд</td>
                            <td>14.1%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно детальной метрики -->
<div class="modal fade" id="metricModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="metricModalTitle">-</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="metricModalBody">
                <!-- Заполняется динамически -->
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно сегмента -->
<div class="modal fade" id="segmentModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="segmentModalTitle">-</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="segmentModalBody">
                <!-- Заполняется динамически -->
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно концентрации -->
<div class="modal fade" id="concentrationModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title">
                    <i class="bi bi-exclamation-triangle me-2"></i>Анализ концентрации рынка
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>Индекс Херфиндаля-Хиршмана (HHI)</h6>
                <div class="progress mb-3" style="height: 30px;">
                    <div class="progress-bar bg-warning" style="width: 58.2%">0.145 (Умеренная)</div>
                </div>
                <small class="text-muted">HHI < 0.1 - низкая концентрация | 0.1-0.18 - умеренная | > 0.18 - высокая</small>

                <h6 class="mt-4">Доли рынка топ-5 компаний</h6>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Компания</th>
                            <th>Доля рынка</th>
                            <th>Кумулятивно</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1. Халык-Life</td>
                            <td>18.5%</td>
                            <td>18.5%</td>
                        </tr>
                        <tr>
                            <td>2. Евразия</td>
                            <td>12.8%</td>
                            <td>31.3%</td>
                        </tr>
                        <tr>
                            <td>3. Nomad Life</td>
                            <td>10.2%</td>
                            <td>41.5%</td>
                        </tr>
                        <tr>
                            <td>4. Freedom Life</td>
                            <td>8.5%</td>
                            <td>50.0%</td>
                        </tr>
                        <tr>
                            <td>5. Казахинстрах</td>
                            <td>8.2%</td>
                            <td>58.2%</td>
                        </tr>
                    </tbody>
                </table>

                <h6 class="mt-4">Рекомендации</h6>
                <ul>
                    <li>Мониторинг слияний и поглощений в отрасли</li>
                    <li>Содействие входу новых участников на рынок</li>
                    <li>Анализ ценовой политики лидеров рынка</li>
                    <li>Оценка влияния на потребителей</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Инициализация страницы
    document.addEventListener('DOMContentLoaded', function() {
        initCharts();
    });

    // Инициализация графиков
    function initCharts() {
        // Динамика рынка
        new Chart(document.getElementById('marketDynamicsChart'), {
            type: 'line',
            data: {
                labels: ['2021', '2022', '2023', '2024', 'Q3 2025'],
                datasets: [
                    {
                        label: 'Премии (млрд)',
                        data: [1250, 1420, 1580, 1720, 1850],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Выплаты (млрд)',
                        data: [580, 650, 720, 780, 892],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Активы (млрд)',
                        data: [1850, 2100, 2350, 2580, 2850],
                        borderColor: '#27ae60',
                        tension: 0.3,
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: { legend: { position: 'top' } },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Структура рынка
        new Chart(document.getElementById('marketStructureChart'), {
            type: 'doughnut',
            data: {
                labels: ['Life', 'Авто', 'Имущество', 'ДМС', 'Ответственность', 'Прочие'],
                datasets: [{
                    data: [26.2, 22.3, 17.6, 15.4, 10.7, 7.8],
                    backgroundColor: ['#3498db', '#27ae60', '#f39c12', '#e74c3c', '#9b59b6', '#95a5a6']
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { position: 'right' } }
            }
        });

        // Премии по сегментам
        new Chart(document.getElementById('segmentPremiumsChart'), {
            type: 'bar',
            data: {
                labels: ['Life', 'Авто', 'Имущество', 'ДМС', 'Ответственность', 'Грузы', 'Прочие'],
                datasets: [{
                    label: 'Премии (млрд ₸)',
                    data: [485, 412, 325, 285, 198, 85, 60],
                    backgroundColor: ['#3498db', '#27ae60', '#f39c12', '#e74c3c', '#9b59b6', '#1abc9c', '#95a5a6']
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } }
            }
        });

        // Рост по сегментам
        new Chart(document.getElementById('segmentGrowthChart'), {
            type: 'bar',
            data: {
                labels: ['Life', 'ДМС', 'Ответст.', 'Имущ.', 'Авто', 'Прочие', 'Грузы'],
                datasets: [{
                    label: 'Рост YoY (%)',
                    data: [22.5, 18.2, 15.8, 12.3, 8.5, 2.1, -5.2],
                    backgroundColor: function(context) {
                        return context.raw >= 0 ? '#27ae60' : '#e74c3c';
                    }
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                plugins: { legend: { display: false } }
            }
        });

        // Топ компании
        new Chart(document.getElementById('topCompaniesChart'), {
            type: 'bar',
            data: {
                labels: ['Халык-Life', 'Евразия', 'Nomad Life', 'Freedom Life', 'Казахинстрах', 'Виктория', 'Интертич', 'Аманат', 'Компетенц', 'Базель'],
                datasets: [{
                    label: 'Премии (млрд)',
                    data: [125.4, 98.5, 89.3, 78.2, 65.4, 52.8, 48.5, 45.8, 35.2, 28.4],
                    backgroundColor: '#3498db'
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                plugins: { legend: { display: false } }
            }
        });

        // Региональное распределение
        new Chart(document.getElementById('regionalChart'), {
            type: 'pie',
            data: {
                labels: ['Алматы', 'Астана', 'Западный КЗ', 'Южный КЗ', 'Прочие'],
                datasets: [{
                    data: [37.0, 23.0, 15.4, 10.5, 14.1],
                    backgroundColor: ['#3498db', '#27ae60', '#f39c12', '#e74c3c', '#95a5a6']
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { position: 'bottom' } }
            }
        });
    }

    // Показать детальную метрику
    function showDetailedMetric(metric) {
        const metrics = {
            'premiums': {
                title: 'Валовые премии',
                content: `
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Динамика премий</h6>
                            <table class="table table-sm">
                                <tr><td>2021</td><td>1,250 млрд ₸</td></tr>
                                <tr><td>2022</td><td>1,420 млрд ₸</td></tr>
                                <tr><td>2023</td><td>1,580 млрд ₸</td></tr>
                                <tr><td>2024</td><td>1,720 млрд ₸</td></tr>
                                <tr><td>Q3 2025</td><td>1,850 млрд ₸</td></tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6>Прогноз на 2025</h6>
                            <p>Ожидаемый рост: <strong>+12-15%</strong></p>
                            <p>Целевой показатель: <strong>2,000 млрд ₸</strong></p>
                        </div>
                    </div>
                `
            },
            'claims': {
                title: 'Выплаты',
                content: `
                    <h6>Структура выплат</h6>
                    <table class="table">
                        <tr><td>Автострахование</td><td>312 млрд ₸</td><td>35%</td></tr>
                        <tr><td>ДМС</td><td>178 млрд ₸</td><td>20%</td></tr>
                        <tr><td>Life</td><td>152 млрд ₸</td><td>17%</td></tr>
                        <tr><td>Имущество</td><td>125 млрд ₸</td><td>14%</td></tr>
                        <tr><td>Прочие</td><td>125 млрд ₸</td><td>14%</td></tr>
                    </table>
                `
            },
            'assets': {
                title: 'Активы рынка',
                content: `
                    <h6>Структура активов</h6>
                    <table class="table">
                        <tr><td>Государственные ценные бумаги</td><td>1,140 млрд ₸</td><td>40%</td></tr>
                        <tr><td>Корпоративные облигации</td><td>570 млрд ₸</td><td>20%</td></tr>
                        <tr><td>Депозиты</td><td>428 млрд ₸</td><td>15%</td></tr>
                        <tr><td>Акции</td><td>285 млрд ₸</td><td>10%</td></tr>
                        <tr><td>Прочие</td><td>427 млрд ₸</td><td>15%</td></tr>
                    </table>
                `
            },
            'penetration': {
                title: 'Проникновение страхования',
                content: `
                    <h6>Сравнение с другими странами</h6>
                    <table class="table">
                        <tr><td>Казахстан</td><td>1.8%</td></tr>
                        <tr><td>Россия</td><td>1.4%</td></tr>
                        <tr><td>Польша</td><td>2.8%</td></tr>
                        <tr><td>Чехия</td><td>3.2%</td></tr>
                        <tr><td>Среднее по ЕС</td><td>7.5%</td></tr>
                    </table>
                    <p class="text-muted">Потенциал роста значительный</p>
                `
            }
        };

        const data = metrics[metric];
        document.getElementById('metricModalTitle').textContent = data.title;
        document.getElementById('metricModalBody').innerHTML = data.content;
        new bootstrap.Modal(document.getElementById('metricModal')).show();
    }

    // Показать детали сегмента
    function showSegmentDetails(segment) {
        const segments = {
            'life': { name: 'Life страхование', premiums: '485 млрд ₸', growth: '+22.5%', companies: 8 },
            'auto': { name: 'Автострахование', premiums: '412 млрд ₸', growth: '+8.5%', companies: 18 },
            'property': { name: 'Имущество', premiums: '325 млрд ₸', growth: '+12.3%', companies: 15 },
            'health': { name: 'ДМС', premiums: '285 млрд ₸', growth: '+18.2%', companies: 12 },
            'liability': { name: 'Ответственность', premiums: '198 млрд ₸', growth: '+15.8%', companies: 14 },
            'cargo': { name: 'Грузы', premiums: '85 млрд ₸', growth: '-5.2%', companies: 10 },
            'other': { name: 'Прочие', premiums: '60 млрд ₸', growth: '+2.1%', companies: 8 }
        };

        const data = segments[segment];
        document.getElementById('segmentModalTitle').textContent = data.name;
        document.getElementById('segmentModalBody').innerHTML = `
            <div class="row">
                <div class="col-md-4">
                    <div class="card bg-light">
                        <div class="card-body text-center">
                            <div class="h4 text-primary">${data.premiums}</div>
                            <small>Премии</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-light">
                        <div class="card-body text-center">
                            <div class="h4 ${data.growth.includes('+') ? 'text-success' : 'text-danger'}">${data.growth}</div>
                            <small>Рост YoY</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-light">
                        <div class="card-body text-center">
                            <div class="h4">${data.companies}</div>
                            <small>Компаний</small>
                        </div>
                    </div>
                </div>
            </div>
            <hr>
            <p class="text-muted">Детальная аналитика сегмента "${data.name}" будет доступна в полной версии.</p>
        `;
        new bootstrap.Modal(document.getElementById('segmentModal')).show();
    }

    // Показать анализ концентрации
    function showConcentrationAnalysis() {
        new bootstrap.Modal(document.getElementById('concentrationModal')).show();
    }

    // Установить период графика
    function setChartPeriod(period) {
        showToast('Период изменен на ' + period, 'info');
    }

    // Экспорт данных сегментов
    function exportSegmentData() {
        showLoading();
        setTimeout(() => {
            hideLoading();
            showToast('Данные экспортированы в Excel', 'success');
        }, 1500);
    }
</script>
{% endblock %}

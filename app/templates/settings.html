{% extends "base.html" %}

{% block title %}Настройки системы{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="mb-2">
                <i class="bi bi-gear text-primary"></i>
                Настройки системы
            </h1>
            <p class="text-muted">Конфигурация интеграций, пользователей и параметров расчета</p>
        </div>
    </div>

    <div class="row">
        <!-- Интеграция с 1С -->
        <div class="col-md-6 mb-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white">
                    <h5 class="mb-0">
                        <i class="bi bi-link-45deg text-primary"></i>
                        Интеграция с 1С
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        Система автоматически подгружает данные из 1С:Предприятие 8.3 через API
                    </div>

                    <form>
                        <div class="mb-3">
                            <label class="form-label"><strong>URL сервера 1С</strong></label>
                            <input type="text" class="form-control" value="http://1c-server.local:8080/api" disabled>
                        </div>

                        <div class="mb-3">
                            <label class="form-label"><strong>База данных</strong></label>
                            <input type="text" class="form-control" value="InsuranceCompany" disabled>
                        </div>

                        <div class="mb-3">
                            <label class="form-label"><strong>Статус подключения</strong></label>
                            <div>
                                <span class="badge bg-success">
                                    <i class="bi bi-check-circle"></i> Подключено
                                </span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label"><strong>Последняя синхронизация</strong></label>
                            <div>{{ macro.reporting_date }} 15:30</div>
                        </div>

                        <hr>

                        <div class="mb-3">
                            <h6>Настройка автоматической загрузки</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="autoSync" checked disabled>
                                <label class="form-check-label" for="autoSync">
                                    Автоматически загружать данные каждый день в 00:00
                                </label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label"><strong>Что загружать из 1С:</strong></label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="loadFI" checked disabled>
                                <label class="form-check-label" for="loadFI">
                                    Финансовые инструменты (счета 1010-1070)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="loadIC" checked disabled>
                                <label class="form-check-label" for="loadIC">
                                    Страховые договоры (счета 3110-3150)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="loadCapital" checked disabled>
                                <label class="form-check-label" for="loadCapital">
                                    Капитал и резервы (счета 5000-5900)
                                </label>
                            </div>
                        </div>

                        <button type="button" class="btn btn-primary" disabled>
                            <i class="bi bi-arrow-repeat"></i> Синхронизировать сейчас
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- План счетов -->
        <div class="col-md-6 mb-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white">
                    <h5 class="mb-0">
                        <i class="bi bi-diagram-3 text-success"></i>
                        План счетов
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">Соответствие счетов бухгалтерского учета классификации МСФО</p>

                    <h6 class="mt-3">МСФО 9 - Финансовые инструменты</h6>
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>Счет 1С</th>
                                    <th>Классификация МСФО 9</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1010-1020</td>
                                    <td><span class="badge bg-warning text-dark">AC</span> Денежные средства</td>
                                </tr>
                                <tr>
                                    <td>1030</td>
                                    <td><span class="badge bg-warning text-dark">AC</span> Депозиты</td>
                                </tr>
                                <tr>
                                    <td>1040-1050</td>
                                    <td><span class="badge bg-success">FVOCI</span> Гос. ценные бумаги</td>
                                </tr>
                                <tr>
                                    <td>1060</td>
                                    <td><span class="badge bg-danger">FVTPL</span> Корп. ценные бумаги</td>
                                </tr>
                                <tr>
                                    <td>1070</td>
                                    <td><span class="badge bg-warning text-dark">AC</span> Займы выданные</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h6 class="mt-4">МСФО 17 - Страховые договоры</h6>
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>Счет 1С</th>
                                    <th>Тип договора</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>3110</td>
                                    <td>Резервы по страхованию жизни</td>
                                </tr>
                                <tr>
                                    <td>3120</td>
                                    <td>Резервы по общему страхованию</td>
                                </tr>
                                <tr>
                                    <td>3130</td>
                                    <td>Резервы убытков</td>
                                </tr>
                                <tr>
                                    <td>3140</td>
                                    <td>Резервы незаработанной премии</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Параметры расчета -->
        <div class="col-md-6 mb-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">
                        <i class="bi bi-calculator text-warning"></i>
                        Параметры расчета
                    </h5>
                </div>
                <div class="card-body">
                    <h6>Макроэкономические параметры</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <tbody>
                                <tr>
                                    <td><strong>Ставка рефинансирования</strong></td>
                                    <td>{{ "%.2f"|format(macro.kzt_rate|float) }}%</td>
                                </tr>
                                <tr>
                                    <td><strong>Инфляция</strong></td>
                                    <td>{{ "%.2f"|format(macro.inflation|float) }}%</td>
                                </tr>
                                <tr>
                                    <td><strong>Курс USD/KZT</strong></td>
                                    <td>₸ {{ "%.2f"|format(macro.usd_kzt|float) }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Курс EUR/KZT</strong></td>
                                    <td>₸ {{ "%.2f"|format(macro.eur_kzt|float) }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Курс RUB/KZT</strong></td>
                                    <td>₸ {{ "%.2f"|format(macro.rub_kzt|float) }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <hr>

                    <h6>Параметры ECL (МСФО 9)</h6>
                    <form>
                        <div class="mb-3">
                            <label class="form-label">LGD (Loss Given Default)</label>
                            <input type="number" class="form-control" value="0.45" step="0.01" disabled>
                            <small class="text-muted">По умолчанию 45%</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Confidence Level</label>
                            <input type="number" class="form-control" value="99.5" step="0.1" disabled>
                            <small class="text-muted">Уровень доверия для VaR</small>
                        </div>
                    </form>

                    <h6 class="mt-3">Параметры Risk Adjustment (МСФО 17)</h6>
                    <form>
                        <div class="mb-3">
                            <label class="form-label">Метод расчета</label>
                            <select class="form-select" disabled>
                                <option selected>Cost of Capital (CoC)</option>
                                <option>Confidence Level (VaR)</option>
                                <option>Margin</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">CoC ставка</label>
                            <input type="number" class="form-control" value="6.0" step="0.1" disabled>
                            <small class="text-muted">Стоимость капитала, %</small>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Пользователи и доступы -->
        <div class="col-md-6 mb-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">
                        <i class="bi bi-people text-info"></i>
                        Пользователи и доступы
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i>
                        Это демо-версия. Управление пользователями доступно в полной версии.
                    </div>

                    <h6>Текущий пользователь</h6>
                    <div class="card bg-light border-0 mb-3">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                        <i class="bi bi-person-fill fs-4"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h6 class="mb-0">{{ APP_CONFIG.company_name }}</h6>
                                    <small class="text-muted">Администратор</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h6>Роли в системе</h6>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <i class="bi bi-shield-check text-success"></i>
                            <strong>Администратор</strong> - полный доступ
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-calculator text-primary"></i>
                            <strong>Актуарий</strong> - расчеты и отчеты
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-bar-chart text-info"></i>
                            <strong>Аналитик</strong> - просмотр отчетов
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-eye text-secondary"></i>
                            <strong>Наблюдатель</strong> - только чтение
                        </li>
                    </ul>

                    <hr>

                    <h6>Журнал активности</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>Время</th>
                                    <th>Действие</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ macro.reporting_date }} 15:30</td>
                                    <td>Расчет Solvency 2</td>
                                </tr>
                                <tr>
                                    <td>{{ macro.reporting_date }} 14:15</td>
                                    <td>Загрузка данных из 1С</td>
                                </tr>
                                <tr>
                                    <td>{{ macro.reporting_date }} 10:05</td>
                                    <td>Экспорт отчета ECL</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Информация о системе -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">
                        <i class="bi bi-info-circle text-secondary"></i>
                        Информация о системе
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <h6>Название системы</h6>
                            <p>{{ APP_CONFIG.app_name }}</p>
                        </div>
                        <div class="col-md-3">
                            <h6>Версия</h6>
                            <p>{{ APP_CONFIG.version }}</p>
                        </div>
                        <div class="col-md-3">
                            <h6>Компания</h6>
                            <p>{{ APP_CONFIG.company_name }}</p>
                        </div>
                        <div class="col-md-3">
                            <h6>Поддержка</h6>
                            <p>
                                <a href="mailto:support@kz-insurepro.kz">support@kz-insurepro.kz</a><br>
                                <a href="tel:+77172000000">+7 (717) 200-00-00</a>
                            </p>
                        </div>
                    </div>

                    <hr>

                    <div class="alert alert-info mb-0">
                        <div class="d-flex align-items-center">
                            <div class="flex-shrink-0">
                                <i class="bi bi-lightbulb fs-2"></i>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="mb-1">Демо-версия</h6>
                                <p class="mb-0">
                                    Вы используете демонстрационную версию системы.
                                    Для получения полной версии с возможностью редактирования настроек,
                                    управления пользователями и интеграцией с реальной базой 1С,
                                    свяжитесь с нами.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

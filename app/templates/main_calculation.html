{% extends "base.html" %}

{% block title %}–ì–ª–∞–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç - KZ-InsurePro{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex align-items-center justify-content-between">
                <div>
                    <h1 class="mb-1">–ì–ª–∞–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h1>
                    <p class="text-muted">–ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—á–µ—Ç–∞ ECL (–ú–°–§–û 9), BEL/RA/CSM (–ú–°–§–û 17) –∏ –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</p>
                </div>
                <div>
                    <span class="badge bg-info">IFRS 9 + IFRS 17 + Solvency</span>
                </div>
            </div>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ -->
    <div class="card mb-4 border-0 shadow-sm">
        <div class="card-header bg-light border-bottom">
            <h5 class="mb-0">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á–µ—Ç–∞</h5>
        </div>
        <div class="card-body">
            <form method="POST" id="calculationForm">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="gca" class="form-label">–í–∞–ª–æ–≤–∞—è –æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (GCA)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="gca" name="gca" value="500000000" step="1000000">
                            <span class="input-group-text">‚Ç∏</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="pd" class="form-label">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–µ—Ñ–æ–ª—Ç–∞ (PD –≥–æ–¥–æ–≤–∞—è)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="pd" name="pd" value="0.095" step="0.001" min="0" max="1">
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="lgd" class="form-label">–ü–æ—Ç–µ—Ä–∏ –ø—Ä–∏ –¥–µ—Ñ–æ–ª—Ç–µ (LGD)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="lgd" name="lgd" value="0.69" step="0.01" min="0" max="1">
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="eir" class="form-label">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (EIR)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="eir" name="eir" value="0.19" step="0.01" min="0">
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="term" class="form-label">–û—Å—Ç–∞–≤—à–∏–π—Å—è —Å—Ä–æ–∫ (–ª–µ—Ç)</label>
                        <input type="number" class="form-control" id="term" name="term" value="3" min="1" max="50">
                    </div>
                    <div class="col-md-6">
                        <label for="dpd" class="form-label">–î–Ω–µ–π –ø—Ä–æ—Å—Ä–æ—á–∫–∏ (DPD)</label>
                        <input type="number" class="form-control" id="dpd" name="dpd" value="0" min="0">
                    </div>
                </div>

                <!-- –ú–°–§–û 17 –ø–∞—Ä–∞–º–µ—Ç—Ä—ã -->
                <hr class="my-4">
                <h6 class="mb-3 text-primary">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ú–°–§–û 17 (–î–æ–≥–æ–≤–æ—Ä—ã —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è)</h6>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="premiums" class="form-label">–ü—Ä–µ–º–∏–∏ (–ø–µ—Ä–≤—ã–π –≥–æ–¥)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="premiums" name="premiums" value="100000000" step="1000000">
                            <span class="input-group-text">‚Ç∏</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="claims" class="form-label">–£–±—ã—Ç–∫–∏ (–≤ –≥–æ–¥)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="claims" name="claims" value="80000000" step="1000000">
                            <span class="input-group-text">‚Ç∏</span>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="expenses" class="form-label">–ó–∞—Ç—Ä–∞—Ç—ã (–≤ –≥–æ–¥)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="expenses" name="expenses" value="5000000" step="1000000">
                            <span class="input-group-text">‚Ç∏</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="ac" class="form-label">–ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏–µ</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="ac" name="ac" value="10000000" step="1000000">
                            <span class="input-group-text">‚Ç∏</span>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="contract_term" class="form-label">–°—Ä–æ–∫ –¥–æ–≥–æ–≤–æ—Ä–∞ (–ª–µ—Ç)</label>
                        <input type="number" class="form-control" id="contract_term" name="contract_term" value="10" min="1" max="50">
                    </div>
                    <div class="col-md-6">
                        <label for="ra_method" class="form-label">–ú–µ—Ç–æ–¥ —Ä–∞—Å—á–µ—Ç–∞ RA</label>
                        <select class="form-control" id="ra_method" name="ra_method">
                            <option value="coc">Cost of Capital (CoC)</option>
                            <option value="conditional">Conditional Tail Expectation</option>
                        </select>
                    </div>
                </div>

                <!-- –ü–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã -->
                <hr class="my-4">
                <h6 class="mb-3 text-primary">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</h6>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="equity" class="form-label">–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="equity" name="equity" value="20000000000" step="1000000000">
                            <span class="input-group-text">‚Ç∏</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="subordinated" class="form-label">–ü–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–π –¥–æ–ª–≥</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="subordinated" name="subordinated" value="3000000000" step="1000000000">
                            <span class="input-group-text">‚Ç∏</span>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="illiquid" class="form-label">–ù–µ–ª–∏–∫–≤–∏–¥–Ω—ã–µ –∞–∫—Ç–∏–≤—ã</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="illiquid" name="illiquid" value="500000000" step="100000000">
                            <span class="input-group-text">‚Ç∏</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="k_coef" class="form-label">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç K</label>
                        <input type="number" class="form-control" id="k_coef" name="k_coef" value="0.70" step="0.01" min="0" max="1">
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="ogpo_vts" name="ogpo_vts">
                            <label class="form-check-label" for="ogpo_vts">–ö–æ–º–ø–∞–Ω–∏—è –∏–º–µ–µ—Ç –û–ì–ü–û –í–¢–°</label>
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2 d-sm-flex justify-content-sm-end">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bi bi-calculator"></i> –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞—Å—á–µ—Ç
                    </button>
                    <button type="reset" class="btn btn-outline-secondary btn-lg">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ -->
    {% if result %}
    <!-- –°—Ç–∞—Ç—É—Å -->
    <div class="card mb-4 border-0 shadow-sm">
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="display-6 mb-2">
                            {% if result.status == 'compliant' %}
                            <span class="badge bg-success p-3 fs-5">‚úì –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï</span>
                            {% elif result.status == 'warning' %}
                            <span class="badge bg-warning p-3 fs-5">‚ö† –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï</span>
                            {% else %}
                            <span class="badge bg-danger p-3 fs-5">‚úó –ö–†–ò–¢–ò–ß–ù–û</span>
                            {% endif %}
                        </div>
                        <p class="text-muted">–î–∞—Ç–∞ —Ä–∞—Å—á–µ—Ç–∞: {{ result.calculation_date }}</p>
                    </div>
                </div>
                <div class="col-md-8">
                    {% if result.warnings %}
                    <div class="alert alert-warning mb-0" role="alert">
                        <h6 class="mb-2">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:</h6>
                        <ul class="mb-0">
                            {% for warning in result.warnings %}
                            <li>{{ warning }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% else %}
                    <p class="text-muted">–†–∞—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã ECL -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-light border-bottom d-flex justify-content-between align-items-center" role="button" data-bs-toggle="collapse" data-bs-target="#eclDetails">
                    <h5 class="mb-0">
                        <i class="bi bi-graph-up"></i> –ú–°–§–û 9: Expected Credit Loss (ECL)
                    </h5>
                    <span class="badge bg-info">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –¥–µ—Ç–∞–ª–∏</span>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <small class="d-block text-muted mb-2">ECL</small>
                                <h4 class="mb-1" style="color: #dc3545;">{{ result.ecl_formatted.ecl_amount }}</h4>
                                <small class="text-muted">–°—Ç–∞–¥–∏—è: <strong>{{ result.ecl_formatted.stage }}</strong></small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <small class="d-block text-muted mb-2">–ß–∏—Å—Ç–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</small>
                                <h5 class="mb-1" style="color: #28a745;">{{ result.ecl_formatted.net_value }}</h5>
                                <small class="text-muted">–ü–æ—Å–ª–µ —Ä–µ–∑–µ—Ä–≤–∞</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <small class="d-block text-muted mb-2">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ–∫—Ä—ã—Ç–∏—è</small>
                                <h5 class="mb-1">{{ result.ecl_formatted.coverage_ratio }}</h5>
                                <small class="text-muted">% –æ—Ç –±—Ä—É—Ç—Ç–æ</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <small class="d-block text-muted mb-2">–°—Ç–∞—Ç—É—Å SICR</small>
                                {% if result.ecl_formatted.stage == 'Stage 1' %}
                                <span class="badge bg-success mb-2">–ù–µ—Ç SICR</span>
                                {% elif result.ecl_formatted.stage == 'Stage 2' %}
                                <span class="badge bg-warning mb-2">SICR –≤—ã—è–≤–ª–µ–Ω</span>
                                {% else %}
                                <span class="badge bg-danger mb-2">Default</span>
                                {% endif %}
                                <small class="text-muted d-block">–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ —Ä–∏—Å–∫–∞</small>
                            </div>
                        </div>
                    </div>

                    <!-- –†–∞—Å—à–∏—Ä—è–µ–º—ã–µ –¥–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ -->
                    <div class="collapse mt-4" id="eclDetails">
                        <hr class="my-3">
                        <div class="accordion" id="eclAccordion">
                            <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ö–æ–¥–∞ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#eclInputs">
                                        üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ö–æ–¥–∞
                                    </button>
                                </h2>
                                <div id="eclInputs" class="accordion-collapse collapse" data-bs-parent="#eclAccordion">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <table class="table table-sm table-borderless">
                                                    <tr>
                                                        <td><strong>–í–∞–ª–æ–≤–∞—è –æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (GCA):</strong></td>
                                                        <td><code>{{ result.ecl.gross_carrying_amount }}</code></td>
                                                    </tr>
                                                    <tr>
                                                        <td><strong>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–µ—Ñ–æ–ª—Ç–∞ (PD):</strong></td>
                                                        <td><code>{{ result.ecl.pd_12m }}</code> (12-–º–µ—Å—è—á–Ω–∞—è)</td>
                                                    </tr>
                                                    <tr>
                                                        <td><strong>PD Lifetime:</strong></td>
                                                        <td><code>{{ result.ecl.pd_lifetime }}</code> (—Å—Ä–æ–∫ –¥–æ–≥–æ–≤–æ—Ä–∞)</td>
                                                    </tr>
                                                </table>
                                            </div>
                                            <div class="col-md-6">
                                                <table class="table table-sm table-borderless">
                                                    <tr>
                                                        <td><strong>Loss Given Default (LGD):</strong></td>
                                                        <td><code>0.69</code> (69%)</td>
                                                    </tr>
                                                    <tr>
                                                        <td><strong>Exposure At Default (EAD):</strong></td>
                                                        <td><code>GCA</code></td>
                                                    </tr>
                                                    <tr>
                                                        <td><strong>–î–Ω–µ–π –ø—Ä–æ—Å—Ä–æ—á–∫–∏ (DPD):</strong></td>
                                                        <td><code>0</code> –¥–Ω–µ–π</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è —Ä–∞—Å—á–µ—Ç–∞ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#eclMethodology">
                                        üî¨ –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è (–ú–°–§–û 9)
                                    </button>
                                </h2>
                                <div id="eclMethodology" class="accordion-collapse collapse" data-bs-parent="#eclAccordion">
                                    <div class="accordion-body">
                                        <h6>–§–æ—Ä–º—É–ª–∞ ECL (Expected Credit Loss):</h6>
                                        <pre class="bg-light p-3 rounded border"><code>ECL = PD √ó LGD √ó EAD √ó DiscountFactor</code></pre>

                                        <h6 class="mt-3">–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º –ú–°–§–û 9:</h6>
                                        <table class="table table-sm">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>–°—Ç–∞–¥–∏—è</th>
                                                    <th>PD</th>
                                                    <th>–£—Å–ª–æ–≤–∏–µ</th>
                                                    <th>–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><span class="badge bg-success">Stage 1</span></td>
                                                    <td>12-–º–µ—Å—è—á–Ω–∞—è</td>
                                                    <td>–ù–µ—Ç SICR (Significant Increase in Credit Risk)</td>
                                                    <td>12-–º–µ—Å—è—á–Ω—ã–π ECL</td>
                                                </tr>
                                                <tr>
                                                    <td><span class="badge bg-warning">Stage 2</span></td>
                                                    <td>Lifetime</td>
                                                    <td>SICR –≤—ã—è–≤–ª–µ–Ω, –Ω–æ –Ω–µ –≤ –¥–µ—Ñ–æ–ª—Ç–µ</td>
                                                    <td>Lifetime ECL (–æ—Ç 0.5% –¥–æ 100%)</td>
                                                </tr>
                                                <tr>
                                                    <td><span class="badge bg-danger">Stage 3</span></td>
                                                    <td>Lifetime</td>
                                                    <td>–î–µ—Ñ–æ–ª—Ç –∏–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–∫–∞ > 90 –¥–Ω–µ–π</td>
                                                    <td>–ü–æ–ª–Ω—ã–π Lifetime ECL (100%)</td>
                                                </tr>
                                            </tbody>
                                        </table>

                                        <h6 class="mt-3">–î–µ—Ç–µ–∫—Ü–∏—è SICR –≤ —Å–∏—Å—Ç–µ–º–µ:</h6>
                                        <ul class="small">
                                            <li><strong>–£–≤–µ–ª–∏—á–µ–Ω–∏–µ PD:</strong> PD_—Ç–µ–∫—É—â–∏–π > 1.5 √ó PD_–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π</li>
                                            <li><strong>–î–Ω–µ–π –ø—Ä–æ—Å—Ä–æ—á–∫–∏:</strong> DPD > 30 –¥–Ω–µ–π = –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π SICR</li>
                                            <li><strong>–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã:</strong> –°–Ω–∏–∂–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞, –º–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</li>
                                            <li><strong>Risk migration:</strong> –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è –∫–æ–ª–ª–µ–≥–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- –†–∞—Å—á–µ—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#eclFormula">
                                        üìê –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞—Å—á–µ—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞
                                    </button>
                                </h2>
                                <div id="eclFormula" class="accordion-collapse collapse" data-bs-parent="#eclAccordion">
                                    <div class="accordion-body">
                                        <pre class="bg-light p-3 rounded border" style="font-size: 0.85rem; max-height: 300px; overflow-y: auto;">{{ result.ecl.formula_display }}</pre>
                                        <p class="text-muted small mt-2">{{ result.ecl.justification }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ú–°–§–û 17 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-light border-bottom d-flex justify-content-between align-items-center" role="button" data-bs-toggle="collapse" data-bs-target="#ifrs17Details">
                    <h5 class="mb-0">
                        <i class="bi bi-file-earmark-text"></i> –ú–°–§–û 17: Insurance Contract Accounting
                    </h5>
                    <span class="badge bg-info">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –¥–µ—Ç–∞–ª–∏</span>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <small class="d-block text-muted mb-2">BEL</small>
                                <h5 class="mb-1" style="color: #0066cc;">{{ result.ifrs17_formatted.bel }}</h5>
                                <small class="text-muted">Best Estimate Liability</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <small class="d-block text-muted mb-2">RA</small>
                                <h5 class="mb-1" style="color: #ffc107;">{{ result.ifrs17_formatted.ra }}</h5>
                                <small class="text-muted">Risk Adjustment</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <small class="d-block text-muted mb-2">CSM</small>
                                <h5 class="mb-1" style="color: #17a2b8;">{{ result.ifrs17_formatted.csm }}</h5>
                                <small class="text-muted">Contractual Service Margin</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <small class="d-block text-muted mb-2">–û–±—â–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</small>
                                <h5 class="mb-1">{{ result.ifrs17_formatted.total_liability }}</h5>
                                <small class="text-muted">BEL + RA - CSM</small>
                            </div>
                        </div>
                    </div>

                    <!-- –°—Ç–∞—Ç—É—Å –¥–æ–≥–æ–≤–æ—Ä–∞ -->
                    <div class="mt-3">
                        {% if result.ifrs17_formatted.is_onerous == '–î–∞' %}
                        <div class="alert alert-danger" role="alert">
                            <strong>‚ö†Ô∏è –¢—è–∂–µ–ª—ã–π –¥–æ–≥–æ–≤–æ—Ä (Onerous Contract)</strong><br>
                            <small>–î–æ–≥–æ–≤–æ—Ä —Ä–∞—Å—á–∏—Ç–∞–Ω –≤ —É–±—ã—Ç–∫–∏. –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —É–±—ã—Ç–∫–æ–≤ –≤ –ø–µ—Ä–∏–æ–¥ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è.</small>
                        </div>
                        {% else %}
                        <div class="alert alert-success" role="alert">
                            <strong>‚úì –ü—Ä–∏–±—ã–ª—å–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä</strong><br>
                            <small>–ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π –º–∞—Ä–∂–∏–Ω –ø—Ä–∏–±—ã–ª–∏ (CSM) –ø—Ä–∏–∑–Ω–∞–µ—Ç—Å—è –≤ –ø—Ä–∏–±—ã–ª—å –≤ —Ç–µ—á–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.</small>
                        </div>
                        {% endif %}
                    </div>

                    <!-- –†–∞—Å—à–∏—Ä—è–µ–º—ã–µ –¥–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ -->
                    <div class="collapse mt-4" id="ifrs17Details">
                        <hr class="my-3">
                        <div class="accordion" id="ifrs17Accordion">
                            <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#ifrs17Components">
                                        üìä –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
                                    </button>
                                </h2>
                                <div id="ifrs17Components" class="accordion-collapse collapse" data-bs-parent="#ifrs17Accordion">
                                    <div class="accordion-body">
                                        <h6>Best Estimate Liability (BEL) - –ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–∞—è –æ—Ü–µ–Ω–∫–∞</h6>
                                        <p class="small text-muted">
                                            –°—É–º–º–∞ –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç—Ä–∞—Ö–æ–≤—â–∏–∫ –æ–∂–∏–¥–∞–µ—Ç –ø–ª–∞—Ç–∏—Ç—å –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
                                            –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ø–æ —Å—Ç—Ä–∞—Ö–æ–≤—ã–º –¥–æ–≥–æ–≤–æ—Ä–∞–º —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω–æ–π –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ–º.
                                        </p>
                                        <pre class="bg-light p-2 rounded border" style="font-size: 0.75rem;"><code>BEL = PV(Expected Cash Flows)
   = PV(Premiums - Claims - Expenses)</code></pre>

                                        <h6 class="mt-3">Risk Adjustment (RA) - –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –∑–∞ —Ä–∏—Å–∫</h6>
                                        <p class="small text-muted">
                                            –ü—Ä–µ–º–∏—è –∑–∞ –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ—Å—Ç—å –∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤.
                                            –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–∞–ø–∏—Ç–∞–ª–∞ (CoC) –∏–ª–∏ —É—Å–ª–æ–≤–Ω–æ–≥–æ —Ö–≤–æ—Å—Ç–æ–≤–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è (CTE).
                                        </p>
                                        <pre class="bg-light p-2 rounded border" style="font-size: 0.75rem;"><code>RA = 75-–π percentile(Losses) - BEL
   ‚âà BEL √ó RiskMargin% √ó (1 + MarginSpread)</code></pre>

                                        <h6 class="mt-3">Contractual Service Margin (CSM) - –ú–∞—Ä–∂–∏–Ω –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è</h6>
                                        <p class="small text-muted">
                                            –†–µ–∑–µ—Ä–≤ –ø—Ä–∏–±—ã–ª–∏ –æ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å). –ê–º–æ—Ä—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.
                                            –ï—Å–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª–µ–Ω = —Ç—è–∂–µ–ª—ã–π –¥–æ–≥–æ–≤–æ—Ä.
                                        </p>
                                        <pre class="bg-light p-2 rounded border" style="font-size: 0.75rem;"><code>CSM = (PV(Premiums) - BEL - RA) √ó (–µ—Å–ª–∏ > 0)
   = PV(Profit)  // –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥ –∏–ª–∏ —É–±—ã—Ç–æ–∫</code></pre>

                                        <hr class="my-2">
                                        <h6>–ü–æ–ª–Ω–∞—è –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:</h6>
                                        <pre class="bg-primary-light p-2 rounded border text-dark" style="font-size: 0.85rem;"><code>Total Liability = BEL + RA - CSM

–ï—Å–ª–∏ CSM < 0 (Onerous):
  Total Liability = BEL + RA + |CSM|  // –£–±—ã—Ç–æ–∫ –ø—Ä–∏–∑–Ω–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É</code></pre>
                                    </div>
                                </div>
                            </div>

                            <!-- –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è —Ä–∞—Å—á–µ—Ç–∞ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ifrs17Methodology">
                                        üî¨ –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è (General Measurement Model - GMM)
                                    </button>
                                </h2>
                                <div id="ifrs17Methodology" class="accordion-collapse collapse" data-bs-parent="#ifrs17Accordion">
                                    <div class="accordion-body">
                                        <h6>–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è:</h6>
                                        <table class="table table-sm">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>–ú–æ–¥–µ–ª—å</th>
                                                    <th>–ü—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å</th>
                                                    <th>–°–ª–æ–∂–Ω–æ—Å—Ç—å</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><strong>GMM</strong></td>
                                                    <td>–í—Å–µ —Ç–∏–ø—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤</td>
                                                    <td>–í—ã—Å–æ–∫–∞—è (–ø–æ–ª–Ω—ã–µ –¥–µ–Ω–µ–∂–Ω—ã–µ –ø–æ—Ç–æ–∫–∏)</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>VFA</strong></td>
                                                    <td>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã</td>
                                                    <td>–°—Ä–µ–¥–Ω—è—è (–≤–∞—Ä–∏–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–±—ã–ª–∏)</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>PAA</strong></td>
                                                    <td>–ü—Ä–æ—Å—Ç—ã–µ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ</td>
                                                    <td>–ù–∏–∑–∫–∞—è (–ø—Ä–µ–º–∏–∏ - —É–±—ã—Ç–∫–∏)</td>
                                                </tr>
                                            </tbody>
                                        </table>

                                        <h6 class="mt-3">–≠—Ç–∞–ø—ã —Ä–∞—Å—á–µ—Ç–∞ GMM:</h6>
                                        <ol class="small">
                                            <li><strong>–ü—Ä–æ–≥–Ω–æ–∑ –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤:</strong> –û–∂–∏–¥–∞–µ–º—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –ø–æ –ø—Ä–∏—Ç—è–∑–∞–Ω–∏—è–º, —Ä–∞—Å—Ö–æ–¥—ã –∏ –∫–æ–º–∏—Å—Å–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö</li>
                                            <li><strong>–î–∏—Å–∫–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong> –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ —Ç–µ–∫—É—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ —Å—Ç–∞–≤–∫–µ –¥–∏—Å–∫–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–π –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏</li>
                                            <li><strong>BEL —Ä–∞—Å—á–µ—Ç:</strong> –í–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤</li>
                                            <li><strong>RA –∫–æ–ª–∏—á–∏—Ñ–∏–∫–∞—Ü–∏—è:</strong> –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞ –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ—Å—Ç—å (–æ–±—ã—á–Ω–æ 0.5-5%)</li>
                                            <li><strong>CSM –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:</strong> –û—Å—Ç–∞—Ç–æ–∫ –ø—Ä–∏–±—ã–ª–∏ –∏–ª–∏ —É–±—ã—Ç–∫–∞</li>
                                            <li><strong>–ì–æ–¥–æ–≤–æ–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ:</strong> –ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è CSM –≤ —Ç–µ—á–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è</li>
                                        </ol>

                                        <h6 class="mt-3">–î–µ—Ç–µ–∫—Ü–∏—è onerous contract:</h6>
                                        <ul class="small">
                                            <li>–ü—Ä–∏ –≤—ã–ø—É—Å–∫–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞: –ï—Å–ª–∏ (Premiums - BEL - RA) < 0 ‚Üí CSM –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª–µ–Ω</li>
                                            <li>–ü—Ä–∏ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–µ: –ï—Å–ª–∏ CSM —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤ —É–±—ã—Ç–æ–∫</li>
                                            <li>–ù–µ—Ç –æ—Ç–∫–∞—Ç–∞: –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π CSM –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –¥–∞–∂–µ –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏—è —É–ª—É—á—à–∞—Ç—Å—è</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- –†–∞—Å—á–µ—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ifrs17Formula">
                                        üìê –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞—Å—á–µ—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞
                                    </button>
                                </h2>
                                <div id="ifrs17Formula" class="accordion-collapse collapse" data-bs-parent="#ifrs17Accordion">
                                    <div class="accordion-body">
                                        <pre class="bg-light p-3 rounded border" style="font-size: 0.85rem; max-height: 400px; overflow-y: auto;">{{ result.ifrs17.formula_display }}</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-light border-bottom d-flex justify-content-between align-items-center" role="button" data-bs-toggle="collapse" data-bs-target="#solvencyDetails">
                    <h5 class="mb-0">
                        <i class="bi bi-shield-check"></i> –ü–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å (Solvency - N–º–ø –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç)
                    </h5>
                    <span class="badge bg-info">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –¥–µ—Ç–∞–ª–∏</span>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <small class="d-block text-muted mb-2">MMP</small>
                                <h5 class="mb-1" style="color: #6f42c1;">{{ result.solvency_formatted.mmp }}</h5>
                                <small class="text-muted">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <small class="d-block text-muted mb-2">FMP</small>
                                <h5 class="mb-1" style="color: #20c997;">{{ result.solvency_formatted.fmp }}</h5>
                                <small class="text-muted">–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <small class="d-block text-muted mb-2">N–º–ø Ratio</small>
                                <h5 class="mb-1" style="color: #fd7e14;">{{ result.solvency_formatted.ratio }}</h5>
                                <small class="text-muted">FMP √∑ MMP</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <small class="d-block text-muted mb-2">–°—Ç–∞—Ç—É—Å</small>
                                {% if result.solvency.is_compliant %}
                                <span class="badge bg-success mb-2" style="font-size: 1rem;">‚úì OK</span>
                                {% else %}
                                <span class="badge bg-danger mb-2" style="font-size: 1rem;">‚úó Breach</span>
                                {% endif %}
                                <small class="text-muted">–ú–∏–Ω. 1.0</small>
                            </div>
                        </div>
                    </div>

                    <!-- –°—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ -->
                    <div class="mt-3">
                        {% if result.solvency.is_compliant %}
                        <div class="alert alert-success" role="alert">
                            <strong>‚úì –ü–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–∞</strong><br>
                            <small>–ö–æ–º–ø–∞–Ω–∏—è –∏–º–µ–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ (FMP) –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ç—Ä–µ–±—É–µ–º–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞ (MMP) —Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º N–º–ø = FMP/MMP > 1.0</small>
                        </div>
                        {% else %}
                        <div class="alert alert-danger" role="alert">
                            <strong>‚ö†Ô∏è –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</strong><br>
                            <small>–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ (FMP) –Ω–∏–∂–µ –º–∏–Ω–∏–º—É–º–∞ (MMP). –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–∞.</small>
                        </div>
                        {% endif %}
                    </div>

                    <!-- –†–∞—Å—à–∏—Ä—è–µ–º—ã–µ –¥–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ -->
                    <div class="collapse mt-4" id="solvencyDetails">
                        <hr class="my-3">
                        <div class="accordion" id="solvencyAccordion">
                            <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#solvencyComponents">
                                        üìä –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (N–º–ø)
                                    </button>
                                </h2>
                                <div id="solvencyComponents" class="accordion-collapse collapse" data-bs-parent="#solvencyAccordion">
                                    <div class="accordion-body">
                                        <h6>MMP (–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ç—Ä–µ–±—É–µ–º–æ–µ –∫–∞–ø–∏—Ç–∞–ª–æ—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ)</h6>
                                        <p class="small text-muted">
                                            –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∫–∞–ø–∏—Ç–∞–ª–∞, –∫–æ—Ç–æ—Ä—É—é –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å —Å—Ç—Ä–∞—Ö–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
                                            –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –±—Ä—É—Ç—Ç–æ-–ø—Ä–µ–º–∏–π –∏ —É–±—ã—Ç–∫–æ–≤.
                                        </p>
                                        <pre class="bg-light p-2 rounded border" style="font-size: 0.75rem;"><code>MMP = max(Min‚ÇÅ, Min‚ÇÇ) + Adjustment

–≥–¥–µ:
  Min‚ÇÅ = 4% √ó Gross Premiums (–∑–∞ 1 –≥–æ–¥)
  Min‚ÇÇ = 25% √ó Incurred Claims (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –≥–æ–¥–∞)
  Adjustment = K-coefficient √ó portfolio size</code></pre>

                                        <h6 class="mt-3">FMP (–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞)</h6>
                                        <p class="small text-muted">
                                            –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª, –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è –∞–±—Å–æ—Ä–±—Ü–∏–∏ —É–±—ã—Ç–∫–æ–≤. –í–∫–ª—é—á–∞–µ—Ç –∞–∫—Ü–∏–æ–Ω–µ—Ä–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª,
                                            –ø—Ä–∏–±—ã–ª–∏, —Ä–µ–∑–µ—Ä–≤—ã –∏ –ø—Ä–æ—á–∏–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.
                                        </p>
                                        <pre class="bg-light p-2 rounded border" style="font-size: 0.75rem;"><code>FMP = Share Capital + Retained Earnings + Reserves
      - ECL Adjustments - CSM Impact - Illiquid Assets
      + Subordinated Debt</code></pre>

                                        <h6 class="mt-3">N–º–ø –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</h6>
                                        <p class="small text-muted">
                                            –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å > 1.0 –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏.
                                            –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç < 1.5 —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.
                                        </p>
                                        <pre class="bg-light p-2 rounded border" style="font-size: 0.85rem;"><code>N–º–ø = FMP / MMP

–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:
  > 2.0: –•–æ—Ä–æ—à–∞—è –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
  1.5 - 2.0: –ê–¥–µ–∫–≤–∞—Ç–Ω–∞—è –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
  1.0 - 1.5: –¢—Ä–µ–±—É–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ ‚ö†Ô∏è
  < 1.0: –ù–ê–†–£–®–ï–ù–ò–ï (Breach) üî¥</code></pre>
                                    </div>
                                </div>
                            </div>

                            <!-- –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#stressTest">
                                        ‚ö° –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Stress Test Scenarios)
                                    </button>
                                </h2>
                                <div id="stressTest" class="accordion-collapse collapse" data-bs-parent="#solvencyAccordion">
                                    <div class="accordion-body">
                                        <table class="table table-sm">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>–°—Ü–µ–Ω–∞—Ä–∏–π</th>
                                                    <th>–®–æ–∫–∏ (Shocks)</th>
                                                    <th>N–º–ø Ratio</th>
                                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><strong>–ë–∞–∑–æ–≤—ã–π</strong></td>
                                                    <td>–ë–µ–∑ —à–æ–∫–æ–≤ (baseline)</td>
                                                    <td>{{ result.solvency_formatted.ratio }}</td>
                                                    <td>{% if result.solvency.is_compliant %}<span class="badge bg-success">‚úì OK</span>{% else %}<span class="badge bg-danger">‚úó Fail</span>{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Adverse</strong></td>
                                                    <td>
                                                        <small>
                                                            –ò–Ω—Ñ–ª—è—Ü–∏—è +2% | –£–±—ã—Ç–∫–∏ +10% | FX ¬±3% | –í–∞–ª–æ–≤—ã–µ –ø—Ä–µ–º–∏–∏ -5%
                                                        </small>
                                                    </td>
                                                    <td>{{ result.solvency_formatted.stress_adverse }}</td>
                                                    <td>
                                                        {% if result.solvency.stress_adverse >= 1.0 %}
                                                        <span class="badge bg-warning">‚ö†Ô∏è Edge</span>
                                                        {% else %}
                                                        <span class="badge bg-danger">‚úó Fail</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Severe</strong></td>
                                                    <td>
                                                        <small>
                                                            –ò–Ω—Ñ–ª—è—Ü–∏—è +5% | –£–±—ã—Ç–∫–∏ +25% | FX ¬±8% | –í–∞–ª–æ–≤—ã–µ –ø—Ä–µ–º–∏–∏ -15%
                                                        </small>
                                                    </td>
                                                    <td>{{ result.solvency_formatted.stress_severe }}</td>
                                                    <td>
                                                        {% if result.solvency.stress_severe >= 1.0 %}
                                                        <span class="badge bg-warning">‚ö†Ô∏è Edge</span>
                                                        {% else %}
                                                        <span class="badge bg-danger">‚úó Fail</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><strong>VaR 99.5%</strong></td>
                                                    <td>
                                                        <small>
                                                            –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π —Ö–≤–æ—Å—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (1 –≤ 200)
                                                        </small>
                                                    </td>
                                                    <td>{{ result.solvency_formatted.var_99_5 }}</td>
                                                    <td>
                                                        {% if result.solvency.var_99_5 >= 1.0 %}
                                                        <span class="badge bg-warning">‚ö†Ô∏è Extreme</span>
                                                        {% else %}
                                                        <span class="badge bg-danger">‚úó Fail</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>

                                        <p class="small text-muted mt-2">
                                            <strong>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:</strong> –ö–æ–º–ø–∞–Ω–∏—è –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å N–º–ø > 1.0 –¥–∞–∂–µ –≤ –Ω–µ–±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.
                                            VaR 99.5% –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–æ–≤–µ—Ä–∏—è 99.5%, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º
                                            —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º Solvency 2 –¥–ª—è —Å—Ç—Ä–∞—Ö–æ–≤—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è —Ä–∞—Å—á–µ—Ç–∞ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#solvencyMethodology">
                                        üî¨ –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è (–ê–†–§–† –∫–∞–∑–∞—Ö—Å–∫–∞—è —Ä–µ–≥—É–ª—è—Ü–∏—è)
                                    </button>
                                </h2>
                                <div id="solvencyMethodology" class="accordion-collapse collapse" data-bs-parent="#solvencyAccordion">
                                    <div class="accordion-body">
                                        <h6>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –ê–†–§–† (–ê–≥–µ–Ω—Ç—Å—Ç–≤–æ —Ä–µ–≥—É–ª—è—Ü–∏–∏ –∏ —Ä–∞–∑–≤–∏—Ç–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Ä—ã–Ω–∫–∞):</h6>
                                        <ul class="small">
                                            <li>N–º–ø –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ‚â• 1.0 –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è</li>
                                            <li>MMP = max(4% √ó GPW, 25% √ó ICL, –º–∏–Ω. —Ä–∞–∑–º–µ—Ä) + –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏</li>
                                            <li>K-–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è –û–ì–ü–û –í–¢–° –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 0.70</li>
                                            <li>–ï–∂–µ–≥–æ–¥–Ω–æ–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏</li>
                                            <li>–°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–º —Å –ê–†–§–† —Å—Ü–µ–Ω–∞—Ä–∏—è–º</li>
                                        </ul>

                                        <h6 class="mt-3">–†–∞—Å—á–µ—Ç FMP (–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞):</h6>
                                        <ol class="small">
                                            <li>–ù–∞—á–∏—Å–ª—è–µ—Ç—Å—è –∞–∫—Ü–∏–æ–Ω–µ—Ä–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª (Share Capital)</li>
                                            <li>–î–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –ø—Ä–∏–±—ã–ª–∏</li>
                                            <li>–í—ã—á–∏—Ç–∞—é—Ç—Å—è —É–±—ã—Ç–∫–∏ (ECL) –ø–æ –ú–°–§–û 9</li>
                                            <li>–í—ã—á–∏—Ç–∞—é—Ç—Å—è –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è –ú–°–§–û 17 (CSM < 0)</li>
                                            <li>–í—ã—á–∏—Ç–∞—é—Ç—Å—è –Ω–µ–ª–∏–∫–≤–∏–¥–Ω—ã–µ –∞–∫—Ç–∏–≤—ã (–¥–∏—Å–∫–æ–Ω—Ç 50%)</li>
                                            <li>–î–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å—É–±–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ–ª–≥ (100%)</li>
                                            <li>–†–µ–∑—É–ª—å—Ç–∞—Ç = FMP (Available Own Funds)</li>
                                        </ol>

                                        <h6 class="mt-3">–°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:</h6>
                                        <pre class="bg-light p-2 rounded border" style="font-size: 0.75rem;"><code>–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è:
1. –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –ø—Ä–µ–º–∏–∏ —Å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–æ–π
2. –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —É–±—ã—Ç–∫–∏ —Å –∑–∞–¥–∞–Ω–Ω—ã–º —à–æ–∫–æ–º
3. –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å FMP (–º–æ–∂–µ—Ç —Å–Ω–∏–∑–∏—Ç—å—Å—è)
4. –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å MMP (–º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è)
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å N–º–ø = FMP / MMP ‚â• 1.0</code></pre>
                                    </div>
                                </div>
                            </div>

                            <!-- –†–∞—Å—á–µ—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#solvencyFormula">
                                        üìê –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞—Å—á–µ—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞
                                    </button>
                                </h2>
                                <div id="solvencyFormula" class="accordion-collapse collapse" data-bs-parent="#solvencyAccordion">
                                    <div class="accordion-body">
                                        <pre class="bg-light p-3 rounded border" style="font-size: 0.85rem; max-height: 400px; overflow-y: auto;">{{ result.solvency.formula_display }}</pre>
                                        <p class="text-muted small mt-2">{{ result.solvency.justification }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-light border-bottom">
                    <h5 class="mb-0">
                        <i class="bi bi-table"></i> –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
                    </h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å</th>
                                <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>ECL (–ú–°–§–û 9)</strong></td>
                                <td>{{ result.ecl_formatted.ecl_amount }}</td>
                                <td>
                                    {% if result.ecl.stage == 'Stage 1' %}
                                    <span class="badge bg-success">Stage 1</span>
                                    {% elif result.ecl.stage == 'Stage 2' %}
                                    <span class="badge bg-warning">Stage 2</span>
                                    {% else %}
                                    <span class="badge bg-danger">Stage 3</span>
                                    {% endif %}
                                </td>
                                <td>{{ result.ecl_formatted.coverage_ratio }}</td>
                            </tr>
                            <tr>
                                <td><strong>BEL (–ú–°–§–û 17)</strong></td>
                                <td>{{ result.ifrs17_formatted.bel }}</td>
                                <td><span class="badge bg-info">OK</span></td>
                                <td>Best Estimate</td>
                            </tr>
                            <tr>
                                <td><strong>RA (–ú–°–§–û 17)</strong></td>
                                <td>{{ result.ifrs17_formatted.ra }}</td>
                                <td><span class="badge bg-warning">CoC</span></td>
                                <td>Risk Adjustment</td>
                            </tr>
                            <tr>
                                <td><strong>CSM (–ú–°–§–û 17)</strong></td>
                                <td>{{ result.ifrs17_formatted.csm }}</td>
                                <td>
                                    {% if result.ifrs17.is_onerous %}
                                    <span class="badge bg-danger">Onerous</span>
                                    {% else %}
                                    <span class="badge bg-success">Profitable</span>
                                    {% endif %}
                                </td>
                                <td>Contractual Service Margin</td>
                            </tr>
                            <tr>
                                <td><strong>Nmp (–ü–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å)</strong></td>
                                <td>{{ result.solvency_formatted.ratio }}</td>
                                <td>
                                    {% if result.solvency.is_compliant %}
                                    <span class="badge bg-success">Compliant</span>
                                    {% else %}
                                    <span class="badge bg-danger">Breach</span>
                                    {% endif %}
                                </td>
                                <td>–ú–∏–Ω–∏–º—É–º: 1.0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <div class="alert alert-info" role="alert">
        <h6>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã—à–µ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–í—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞—Å—á–µ—Ç"</h6>
        <p class="mb-0">–°–∏—Å—Ç–µ–º–∞ –≤—ã—á–∏—Å–ª–∏—Ç ECL, –ú–°–§–û 17 –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.</p>
    </div>
    {% endif %}

    {% if error %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>–û—à–∏–±–∫–∞:</strong> {{ error }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}
</div>

<style>
    .card {
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.1) !important;
    }
    pre {
        font-size: 0.85rem;
        max-height: 200px;
        overflow-y: auto;
    }
</style>
{% endblock %}
